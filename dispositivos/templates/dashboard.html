{% extends "base.html" %}
{% block title %}Dashboard · EcoEnergy{% endblock %}

{% block content %}
<div class="row g-3 mb-3">
  <div class="col-md-4">
    <div class="card p-3 h-100">
      <h6 class="text-uppercase fw-bold">Dispositivos por categoría</h6>
      <ul class="list-group list-group-flush mt-2">
        {% for row in devices_by_category %}
          <li class="list-group-item d-flex justify-content-between">
            <span>{{ row.product__category__name|default:"(Sin categoría)" }}</span>
            <span class="badge bg-secondary">{{ row.total }}</span>
          </li>
        {% empty %}
          <li class="list-group-item">Sin datos.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card p-3 h-100">
      <h6 class="text-uppercase fw-bold">Dispositivos por zona</h6>
      <ul class="list-group list-group-flush mt-2">
        {% for row in devices_by_zone %}
          <li class="list-group-item d-flex justify-content-between">
            <span>{{ row.zone__name|default:"(Sin zona)" }}</span>
            <span class="badge bg-secondary">{{ row.total }}</span>
          </li>
        {% empty %}
          <li class="list-group-item">Sin datos.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card p-3 h-100">
      <h6 class="text-uppercase fw-bold">Alertas recientes</h6>
      <ul class="list-group list-group-flush mt-2">
        {% for a in alerts %}
          <li class="list-group-item">
            <div class="small text-muted">{{ a.occurred_at|date:"Y-m-d H:i" }}</div>
            <div><strong>{{ a.device.name }}</strong></div>
            <div>{{ a.alert_rule.name }} · <span class="badge bg-danger">{{ a.alert_rule.severity }}</span></div>
          </li>
        {% empty %}
          <li class="list-group-item">No hay alertas.</li>
        {% endfor %}
      </ul>
      <div class="mt-2 text-end"><a href="{% url 'alert_list' %}">Ver todas</a></div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-lg-7">
    <div class="card p-3">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="text-uppercase fw-bold mb-0">Últimas mediciones</h6>
        <a href="{% url 'measurement_list' %}" class="small">Ver todas</a>
      </div>
      <div class="table-responsive mt-2">
        <table class="table table-sm align-middle">
          <thead><tr><th>Fecha/Hora</th><th>Dispositivo</th><th class="text-end">Energía (kWh)</th></tr></thead>
          <tbody>
            {% for m in measurements %}
              <tr>
                <td>{{ m.measured_at|date:"Y-m-d H:i" }}</td>
                <td><a href="{% url 'device_detail' m.device.id %}">{{ m.device.name }}</a></td>
                <td class="text-end">{{ m.energy_kwh }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="3" class="text-center">Sin mediciones.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card p-3">
      <h6 class="text-uppercase fw-bold mb-2">Accesos rápidos</h6>
      <div class="d-grid gap-2">
        <a class="btn btn-outline-primary" href="{% url 'device_list' %}">Ver dispositivos</a>
        <a class="btn btn-outline-secondary" href="{% url 'alert_list' %}">Ver alertas</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
