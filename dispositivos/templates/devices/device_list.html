{% extends "base.html" %}
{% block title %}Dispositivos · EcoEnergy{% endblock %}
{% block menu_devices %}active{% endblock %}

{% block content %}
<div class="card p-3 shadow-sm">
  <h5 class="mb-3">Dispositivos</h5>

  <form method="get" class="row g-2 align-items-center mb-3">
    <div class="col-auto">
      <label class="form-label mb-0 small">Categoría</label>
      <select name="category" class="form-select">
        <option value="">Todas</option>
        {% for c in categories %}
          <option value="{{ c.id }}" {% if request.GET.category == c.id|stringformat:"s" %}selected{% endif %}>{{ c.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <label class="form-label mb-0 small">Zona</label>
      <select name="zone" class="form-select">
        <option value="">Todas</option>
        {% for z in zones %}
          <option value="{{ z.id }}" {% if request.GET.zone == z.id|stringformat:"s" %}selected{% endif %}>{{ z.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <button class="btn btn-dark mt-4" type="submit">Filtrar</button>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead><tr><th>Nombre</th><th>Organización</th><th>Zona</th><th>Producto</th></tr></thead>
      <tbody>
        {% for d in devices %}
          <tr>
            <td><a href="{% url 'device_detail' d.id %}">{{ d.name }}</a></td>
            <td>{{ d.organization.name }}</td>
            <td>{{ d.zone.name }}</td>
            <td>{{ d.product.name }} ({{ d.product.category.name }})</td>
          </tr>
        {% empty %}
          <tr><td colspan="4" class="text-center">No hay dispositivos.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
